plugins {
  id 'java'
  id 'groovy'
  id 'jacoco'

  id 'org.springframework.boot' version "2.7.1"
  id 'com.coral.tools' version "3.0-SNAPSHOT"
}

apply plugin: "io.spring.dependency-management"
apply plugin: 'com.coral.tools'

group = 'com.ladbrokescoral.oxygen'

def nexusPublic = System.getenv('NEXUS_HOST') ?: 'https://nexus-vie.coral.co.uk/repository/maven-public/'
def nexusUser = System.getenv("NEXUS_USER") ?: project.properties.nexusUser
def nexusPass = System.getenv("NEXUS_PASS") ?: project.properties.nexusPass

repositories {
  maven {
    credentials {
      username = nexusUser
      password = nexusPass
    }
    url nexusPublic
  }
  mavenCentral()
}

configurations {
  all {
    exclude module: 'spring-boot-starter-tomcat'
    exclude module: 'spring-boot-starter-logging'
  }
  compileOnly {
    extendsFrom annotationProcessor
  }
}

dependencies {
  implementation 'org.springframework.boot:spring-boot-starter-actuator'
  implementation 'org.springframework.boot:spring-boot-starter-webflux'
  implementation 'org.springframework.boot:spring-boot-starter-integration'
  implementation 'io.projectreactor:reactor-tools'

  implementation group: 'org.apache.kafka', name: 'kafka_2.10', version: '0.8.2.2'


  // Async logging
  implementation 'org.springframework.boot:spring-boot-starter-log4j2'
  implementation 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml' // log4j
  implementation 'com.lmax:disruptor:3.4.4'

  // custom dependencies
  implementation "com.egalacoral.spark:siteserver-api:release-161.0.0-jdk-17-SNAPSHOT"
  implementation 'com.egalacoral.spark:liveserv-api:1.6'
  implementation 'com.coral:bpp-api:1.20.2'

  testImplementation("org.springframework.boot:spring-boot-starter-test")
  testImplementation 'io.projectreactor:reactor-test'
  testImplementation 'com.squareup.okhttp3:mockwebserver'

}

jacocoTestReport.reports.xml.enabled = true

test {
  systemProperty 'spring.profiles.active', 'LOCAL'
  useJUnitPlatform()
}

springBoot {
  buildInfo()
}

bootBuildImage {
  imageName = "${rootProject.name}"
}

jar{
  enabled=false
}
